# OpenEVSE系统架构概述

## 电源输入
- 连接到电网（L1或L2），提供交流电。

## 主控单元（MCU）
- 基于ATMEL AVR微处理器，运行定制的固件以控制整个充电过程。
- 处理与电动汽车之间的J1772协议通信。
- 包括GFCI保护、接地验证等功能。

## J1772通信接口
- 通过导频信号(Pilot Signal)与电动车进行通信，包括电流限制信息等。
- 使用+12V到-12V的1kHz方波信号，并根据车辆需求调整占空比。

## 继电器控制
- 控制电源向电动汽车的供给，确保安全连接和断开。
- 支持单个DPST或两个SPST继电器配置。

## 用户界面
- 可选配RGB LCD显示屏，用于显示状态信息和设置参数。
- 支持RTC（实时时钟），可用于定时充电功能。

## 外部接口
- **Wi-Fi/蓝牙模块**：用于无线通信，支持远程监控和控制。
- **CAN总线或其他数据接口**：用于获取更详细的车辆信息。

## 扩展能力
- 提供UART/I2C接口，便于集成其他传感器或设备如能量监测器。
- 开放源代码允许开发者添加新的功能或改进现有功能。

## 可视化架构图
为了可视化上述组件及其交互，您可以在图纸上画出各个部分，并用箭头表示信息流和电力流向。例如：
- 从电源输入到主控单元再到J1772接口，然后是车辆；
- 同时，从主控单元到用户界面，以及到Wi-Fi/蓝牙模块等外部接口。


# OpenEVSE 安全逻辑流程

## 电源开启
系统启动。

## 服务级别循环检测AC电源
检测是否有AC电源。

## 继电器卡滞检测与AC电源确认
- 如果有两条AC线，则进入自动设置L1或L2级别；
- 如果只有一条AC线，则进入单线模式。

## GFCI测试
进行GFCI电路测试：
- 测试通过：继续下一步；
- 测试失败：报告GFCI测试错误。

## 电动车连接
确认电动车是否已连接。

## 开始充电
在充电过程中再次执行GFCI测试：
- 测试通过：继续充电；
- 测试失败：报告GFCI测试错误并停止充电。

## 继电器卡滞检测
检查继电器是否打开：
- 继电器正常：继续；
- 继电器卡滞：报告继电器卡滞错误。

## 持续监控
实时监控GFCI、接地情况、内部温度等：
- GFCI故障：显示时间经过并计数倒计时；
- 接地故障：重新测试；
- 无AC电源：重新检测；
- 内部温度达到68°C：将电流限制为50%；
- 内部温度达到65°C：将电流限制为25%；
- 内部温度达到71°C：标记需要服务的过温状态；
- 温度降至62°C以下：恢复原设定的100%电流。

## 警告与显示
当出现高温度警告时，显示相应的警告信息，并在必要时调整电流限制以保护设备。

## 流程简述
电源开启后，系统首先进行AC电源检测，并根据检测结果自动设置为L1或L2级别。接着进行GFCI测试，确保安全后才允许电动车连接并开始充电。在充电期间，系统会不断重复GFCI测试和其他安全检查（如继电器状态、接地情况、内部温度），并在发现问题时采取相应措施（如降低电流、停止充电等）。根据不同的故障类型（如GFCI故障、接地故障、过热等），系统会有不同的响应策略，包括但不限于显示错误信息、重新测试、调整电流限制等。

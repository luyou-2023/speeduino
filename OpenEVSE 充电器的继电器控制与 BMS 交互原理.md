# OpenEVSE 充电器的继电器控制与 BMS 交互原理

## 1. 检测输入电压和电流
- OpenEVSE 通过**电压/电流传感器**监测电网输入，确保电压、电流在安全范围内。

## 2. 读取充电协议（Pilot 信号）
- 通过 **PWM 信号**（Pilot 线）与电动车通信，确认最大允许充电电流。
- Pilot 信号定义了 EVSE（充电桩）与电动车的通信标准。

## 3. 与 BMS（电池管理系统）的交互
- 车辆的 **BMS（Battery Management System）** 通过 Pilot 信号与 OpenEVSE 交换信息，主要包括：
    - **电池当前充电状态（SoC）**：BMS 反馈当前电池的充电进度。
    - **最大可接受电流**：BMS 计算电池可承受的最大充电电流，并向 EVSE 发送请求调整充电电流。
    - **温度管理**：如果 BMS 监测到电池温度过高，会要求降低充电功率或暂停充电。
    - **充电完成指令**：当 BMS 监测到电池充满电，通知 EVSE 终止充电。

## 4. 控制继电器（接触器）
- **MCU（如 ESP32、ATmega328 等）** 依据 **Pilot 信号和 BMS 反馈** 计算允许的充电功率，并驱动继电器（或接触器）**闭合**，让电流流向电动车。
- **动态调节充电电流**：MCU 可以根据 BMS 反馈调整充电功率，防止过载或损坏电池。
- **充电完成后，MCU 断开继电器**，停止充电，确保安全。

## 5. 过流/过温保护
- **过流保护**：如果电流超过设定阈值，MCU 立即断开继电器，防止损坏设备或电池。
- **过温保护**：
    - 监测继电器、充电线缆和 BMS 报告的温度。
    - 如果温度过高，逐步降低充电电流或直接断开继电器。

## 6. 继电器在 OpenEVSE 与 BMS 交互中的作用
- 作为**主电源开关**，控制充电电流的通断。
- 通过 BMS 反馈信息，**调整充电电流**，确保安全高效充电。
- **保护电路**，在异常情况（过流、过温等）下迅速切断电源。

## 7. 总结
OpenEVSE 充电器主要依靠 **MCU+继电器+Pilot 信号**，与 **BMS 交互** 来实现智能充电：
1. **Pilot 信号** 进行基本的 EVSE-EV 交流，确定充电参数。
2. **BMS 提供实时反馈**，包括电池电量、温度、充电能力等信息。
3. **MCU 控制继电器**，根据 BMS 反馈调整充电功率，确保充电安全。
4. **安全机制**（如过流、过温保护）在异常情况下断开继电器，保护设备和电池。

这种架构保证了 **安全、智能、灵活** 的电动车充电管理。
